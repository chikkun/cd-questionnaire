<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>アンケート登録フォーム</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/jquery.ui.all.css"/>
<!--  <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.min.css"/> -->

  <style type="text/css">
.form-horizontal .colabel {
                            float: left;
                            padding-top: 5px;
                            text-align: right;
                            }
label.valid {
              width: 16px;
              height: 16px;
              background: url(images/valid.png) center center no-repeat;
              display: inline-block;
              padding: 0px;
              margin-top: 0px;
              text-indent: -9999px;
              }
label.error {
              font-weight: bold;
              color: red;
              padding: 2px 8px;
              margin-top: 2px;
              display: inline-block;
              }
  </style>
</head>
<body>

<div class="container">
  <div class="row span12">
    <h2>アンケート登録</h2>
  </div>
  <div class="row span12">
    <form id="enquete" role="form" class="form-horizontal" method="post" action="tmp.php">
      <fieldset>
        <div class="control-group row">
          <label for="enquete_name" class="span2 colabel">アンケート名</label>
          <div class="span6">
            <input type="text" name="enquete_name" class="input-medium" value="" placeholder="アンケート名(必須)" data-rule-required="true"/>
          </div>
        </div>
        <div class="control-group row">
          <label for="start_date" class="span2 colabel">開始日</label>

          <div class="span6">
            <input type="text" name="start_date" class="jqueryCalendar input-medium" value="" placeholder="開始日(必須)" data-rule-required="true"/>
          </div>
        </div>
        <div class="control-group row">
          <label for="end_date" class="span2 colabel">終了日</label>

          <div class="span6">
            <input type="text" name="end_date" class="jqueryCalendar input-medium" value="" placeholder="終了日"/>
          </div>
        </div>

        <div id="enquete_questions">
 
          <div id="enquete_questions_template">
            <div class="control-group row">
              <label for="enquete_questions_#index#_question" class="span2 colabel">質問 <span
                      id="enquete_questions_label"></span></label>

              <div class="span3">
                <textarea class="input-medium" id="enquete_questions_#index#_question" data-rule-required="true"
                       name="enquete[questions][#index#][question]" placeholder="質問の文(必須)"></textarea>
              </div>
              <div class='span4'>
                <label for="enquete_questions_#index#_order" class="span1 colabel">順番</label>
                <div class="span2">
                  <input class='questionorders input-mini' id="enquete_questions_#index#_order"
                       name="enquete[questions][#index#][order]" type="text" data-rule-required="true"/>
                </div>
                <button class="delete btn btn-warning btn-mini" id="enquete_questions_remove_current">削除</button>
              </div>
            </div>

            <div id="enquete_questions_#index#_selections">
              <div id="enquete_questions_#index#_selections_template">
                <div class='row'>
                  <div class="control-group">
                    <label for="enquete_questions_#index#_selections_#index_selections#_selection"
                           class="span1 offset2 colabel">選択肢 <span
                            id="enquete_questions_#index#_selections_label"></span></label>

                    <div class="span2">
                      <input id="enquete_questions_#index#_selections_#index_selections#_selection"
                             name="enquete[questions][#index#][selections][#index_selections#][selection]"
                             type="text" placeholder="選択肢" data-rule-required="true" class="input-small"/>
                    </div>
                    <label for="enquete_questions_#index#_selections_#index_selections#_order"
                           class="span1 colabel">順番</label>

                    <div class="span2">
                      <input class='selectionorders input-mini'
                             id="enquete_questions_#index#_selections_#index_selections#_order" data-rule-required="true"
                             name="enquete[questions][#index#][selections][#index_selections#][order]" type="text"/>
                    </div>
                    <div class="span1">
                      <button class="delete btn-inverse btn-mini"
                              id="enquete_questions_#index#_selections_remove_current">削除
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div id="enquete_questions_#index#_selections_noforms_template">選択肢を追加して下さい。</div>
              <!-- Controls -->
              <div class='row'>
                <div id="enquete_questions_#index#_selections_controls" class="span6 offset5">
                  <span id="enquete_questions_#index#_selections_add"><button class="btn-success">選択肢を増やす
                  </button></span>
                  <span id="enquete_questions_#index#_selections_remove_last"><button class="btn-success">最後の選択肢を削除する
                  </button></span>

                  <div id="enquete_questions_#index#_selections_remove_all"><a><span>選択肢全てを削除する</span></a>
                  </div>
                  <div class='row'>　</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- No forms template -->
        <div id="enquete_questions_noforms_template" class='row span3 offset3'>質問を作成して下さい</div>
        <!-- /No forms template-->
        <div id="enquete_questions_controls" class="span6 offset2">
          <div class='row'>
            <span id="enquete_questions_add"><button class="btn-info">質問を増やす</button></span>
            <span id="enquete_questions_remove_last"><button class="btn-info">最後の質問を削除する</button></span>
            <span id="enquete_questions_remove_all"><button class="btn-info">質問を全部削除すする</button></span>
          </div>
          <div class='row'>　</div>
        </div>
        <div class="row span3 offset5">
          <button type="submit" class="btn btn-primary btn-large">　保　存　</button>
        </div>
      </fieldset>
    </form>
  </div>
</div>
  <script src="js/jquery-1.10.1.min.js"></script>
  <script src="js/jquery.ui.core.min.js"></script>
  <script src="js/jquery.ui.datepicker.min.js"></script>
  <script src="js/i18n/jquery.ui.datepicker-ja.min.js"></script>
  <script src="js/jquery.sheepItPlugin.min.js"></script>
  <script src="js/jquery.validate.min.js"></script>
  <script src="js/additional-methods.min.js"></script>
  <script src="js/messages_ja.min.js"></script>
  <script src="js/jquery.dump.min.js"></script>

  <script type="text/javascript">
    $(function () {
	$("#enquete").validate({
	    highlight: function(element) {
		$(element).closest('.control-group').removeClass('valid').addClass('error');
	    },
	    success: function(element) {
	       element
               .text('OK!').addClass('valid')
               .closest('.control-group').removeClass('error').addClass('success');	
	    }
	});
    });
    $(function () {
      $('.jqueryCalendar').datepicker({
        numberOfMonths: 2,
        showButtonPanel: true
      });
    });
    $(document).ready(function () {
      var enquete = $('#enquete_questions').sheepIt({
        separator: '',
        indexFormat: '#index#',
        allowRemoveLast: true,
        allowRemoveCurrent: true,
        allowRemoveAll: true,
        allowAdd: true,
        allowAddN: true,
        maxFormsCount: 10,
        minFormsCount: 0,
        iniFormsCount: 1,
        continuousIndex: true,
        removeAllConfirmationMsg: '質問を全て削除しますが、よろしいですか？',
            data: [
                {
                    'enquete_questions_#index#_question': 'あなたの性別は何ですか？',
                    'enquete_questions_#index#_selections':[
			    {'enquete_questions_0_selections_#index_selections#_selection':'女性'},
			    {'enquete_questions_0_selections_#index_selections#_selection':'男性'}
		    ]
                },
                {
                    'enquete_questions_#index#_question': 'あなたは何歳台ですか？',
                    'enquete_questions_#index#_selections':[
			    {'enquete_questions_1_selections_#index_selections#_selection':'10歳以下'},
			    {'enquete_questions_1_selections_#index_selections#_selection':'20台'},
			    {'enquete_questions_1_selections_#index_selections#_selection':'30台'},
			    {'enquete_questions_1_selections_#index_selections#_selection':'40台'},
			    {'enquete_questions_1_selections_#index_selections#_selection':'50台'},
			    {'enquete_questions_1_selections_#index_selections#_selection':'60歳以上'}
		    ]
                }
            ],
        nestedForms: [
          {
            id: 'enquete_questions_#index#_selections',
            options: {
              separator: '',
              indexFormat: '#index_selections#',
              maxFormsCount: 20,
              iniFormsCount: 0,
              allowRemoveAll: true,
              afterAdd: function (source, newForm) {
                var sorders = $('.selectionorders');
                var f;
                var ssize = sorders.size();
                if (ssize <= 1) {
                  num = 1;
                  sorders[0].value = 1;
                  return;
                }
                var num = 0;
                var beforeNum = 0;
                $(sorders).each(function () {
                  num++;
                  var id = this.id;
                  if (/(\d+)_order/.test(id)) {
                    f = RegExp.$1;
                  } else {
                    f = "1";
                  }
                  if (f == "0") {
                    beforeNum = 0;
                  }
                  if ($(this).val()) {
                    beforeNum = $(this).val();
                  } else {
                    this.value = parseInt(beforeNum) + 1;
                    beforeNum = parseInt(beforeNum) + 1;
                  }
                });
              }
            },
          }
        ],
        afterAdd: function (source, newForm) {
            var orders = $('.questionorders');
            var size = orders.size();
            var num = 0;
            if (size <= 1) {
		num = 1;
		orders[0].value = 1;
            } else {
		num = parseInt(orders[size - 2].value) + 1;
		orders[size - 1].value = num;
            }
        }
      });
    });
  </script>

</body>
</html>
